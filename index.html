import React, { useState, useEffect } from 'react';
import { CheckCircle, XCircle, RotateCcw, Trophy, BookOpen, Target, Star } from 'lucide-react';

const CytologyQuizSystem = () => {
  const [difficulty, setDifficulty] = useState('basic');
  const [gameState, setGameState] = useState('start');
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [userAnswer, setUserAnswer] = useState(null);
  const [showResult, setShowResult] = useState(false);
  const [shuffledQuestions, setShuffledQuestions] = useState([]);

  // å•é¡Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆé›£æ˜“åº¦åˆ¥ï¼‰
  const questionDatabase = {
    basic: [
      {
        id: 1,
        question: "ä¸­çš®è…«ã¯çƒçŠ¶ç´°èƒé›†å¡Šã‚’å¤šæ•°èªã‚ã‚‹ã€‚",
        answer: true,
        explanation: "ä¸­çš®è…«ã§ã¯çƒçŠ¶ã€ä¹³é ­çŠ¶ã€ã¾ã‚Šã‚‚çŠ¶ãªã©ã®é›†å¡ŠãŒå¤šæ•°è¦‹ã‚‰ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã€ã“ã‚Œã¯ä¸­çš®è…«ã‚’è€ƒãˆã‚‹é‡è¦ãªæ‰€è¦‹ã§ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 2,
        question: "ä¸­çš®è…«ã¯å…¨å‘¨æ€§ã®å¾®çµ¨æ¯›ç™ºé”ãŒç‰¹å¾´ã§ã‚ã‚‹ã€‚",
        answer: true,
        explanation: "ä¸­çš®è…«ã§ã¯å…¨å‘¨æ€§ã®å¾®çµ¨æ¯›ç™ºé”ãŒç‰¹å¾´çš„ã§ã™ã€‚ç‰‡å´æ€§ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 3,
        question: "å°ç’°ç´°èƒç™Œã®ç´°èƒè³ªã¯æ³¡æ²«çŠ¶ã‚„ç©ºèƒçŠ¶ã‚’å‘ˆã™ã‚‹ã€‚",
        answer: true,
        explanation: "ä½“è…”æ¶²ä¸­ã«å‡ºç¾ã™ã‚‹èƒƒå°ç’°ç´°èƒç™Œã§ã¯ã€ç´°èƒè³ªãŒæ³¡æ²«çŠ¶ã‚„ç©ºèƒçŠ¶ã®å½¢æ…‹ã‚’ç¤ºã—ã¾ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 4,
        question: "å°ç’°ç´°èƒç™Œã¯PASåå¿œã§ç´°èƒè³ªãŒé¡†ç²’çŠ¶ã«é™½æ€§ã¨ãªã‚‹ã€‚",
        answer: false,
        explanation: "å°ç’°ç´°èƒç™Œã¯PASåå¿œã§ç´°èƒè³ªå†…ã®ç²˜æ¶²ãŒæŸ“ã¾ã‚‹ãŸã‚ã€Œæ»´çŠ¶ã€ã«é™½æ€§ã‚’ç¤ºã—ã¾ã™ã€‚é¡†ç²’çŠ¶ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 5,
        question: "é«„è†œè…«ã§ã¯æ ¸å†…å½å°å…¥ä½“ãŒã—ã°ã—ã°ã¿ã‚‰ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "é«„è†œè…«ã¯æ ¸å†…ç´°èƒè³ªï¼ˆå½ï¼‰å°å…¥ä½“ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒç‰¹å¾´çš„ãªæ‰€è¦‹ã§ã™ã€‚",
        topic: "è„³è„Šé«„"
      },
      {
        id: 6,
        question: "è† èŠ½è…«ã¯è¡€ç®¡ã®å¢—ç”Ÿã«ä¹ã—ã„ã€‚",
        answer: false,
        explanation: "è† èŠ½è…«ã¯è¡€ç®¡ã‚„è¡€ç®¡å†…çš®ç´°èƒã®å¢—ç”ŸãŒé¡•è‘—ãªç‰¹å¾´ã®ä¸€ã¤ã§ã™ã€‚",
        topic: "è„³è„Šé«„"
      },
      {
        id: 7,
        question: "ä¸Šè¡£è…«ã§ã¯è¡€ç®¡å‘¨å›²æ€§å½ãƒ­ã‚¼ãƒƒãƒˆã®å½¢æˆãŒã¿ã‚‰ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "ä¸Šè¡£è…«ã§ã¯ä¸Šè¡£ãƒ­ã‚¼ãƒƒãƒˆï¼ˆçœŸã®ãƒ­ã‚¼ãƒƒãƒˆï¼‰ã‚„è¡€ç®¡å‘¨å›²å½ãƒ­ã‚¼ãƒƒãƒˆãŒã¿ã‚‰ã‚Œã¾ã™ã€‚",
        topic: "è„³è„Šé«„"
      },
      {
        id: 8,
        question: "ä¸­çš®è…«ã§ã¯ã‚ªãƒ¬ãƒ³ã‚¸Gå¥½æ€§ç´°èƒã®å‡ºç¾ãŒã¿ã‚‰ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "ä¸­çš®è…«ã§ã¯ç´°èƒãŒå¤‰æ€§ã—ã¦ä¸­é–“å¾„ãƒ•ã‚£ãƒ©ãƒ¡ãƒ³ãƒˆãŒåç¸®ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ã‚ªãƒ¬ãƒ³ã‚¸Gã«æŸ“ã¾ã‚‹ç´°èƒãŒå‡ºç¾ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 9,
        question: "åµå·£æ˜ç´°èƒç™Œã§ã¯Raspberryå°ä½“ãŒã¿ã‚‰ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "åµå·£æ˜ç´°èƒç™ŒãŒçƒçŠ¶é›†å¡Šã§å‡ºç¾ã™ã‚‹éš›ã€ãã®ä¸­å¤®ã«ã‚®ãƒ ã‚¶ã§ç•°æŸ“æ€§ã‚’ç¤ºã™åŸºåº•è†œæ§˜ç‰©è³ªï¼ˆraspberryå°ä½“ã‚„Itoå°ä½“ï¼‰ã‚’ã¿ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 10,
        question: "æµ¸æ½¤æ€§å°è‘‰ç™Œã¯æ•°ç çŠ¶é…åˆ—ãŒç‰¹å¾´ã§ã‚ã‚‹ã€‚",
        answer: true,
        explanation: "æµ¸æ½¤æ€§å°è‘‰ç™Œã§ã¯æ•°ç çŠ¶é…åˆ—ãŒç‰¹å¾´çš„ã§ã™ã€‚ã“ã‚Œã¯å††å½¢ãƒ»é¡å††å½¢ç´°èƒãŒä¸€åˆ—ã«ä¸¦ã¶çŠ¶æ…‹ã‚’æŒ‡ã—ã¾ã™ã€‚",
        topic: "ä¹³è…º"
      },
      {
        id: 11,
        question: "é«„æ§˜ç™Œã¯å¤§å‹ã§ç•°å‹ã®å¼·ã„è…«ç˜ç´°èƒã¨èƒŒæ™¯ã®ãƒªãƒ³ãƒ‘çƒã®äºŒç›¸æ€§ãŒç‰¹å¾´ã§ã‚ã‚‹ã€‚",
        answer: true,
        explanation: "ä¹³è…ºã®é«„æ§˜ç™Œã¯å¤§å‹ã§ç•°å‹ã®å¼·ã„è…«ç˜ç´°èƒã¨èƒŒæ™¯ã®ãƒªãƒ³ãƒ‘çƒã®äºŒç›¸æ€§ãŒç‰¹å¾´çš„ãªæ‰€è¦‹ã§ã™ã€‚",
        topic: "ä¹³è…º"
      },
      {
        id: 12,
        question: "ç¡å­åŒ–ç´¢çŠ¶è…«ç˜ã§ã¯ç´°èƒè³ªå†…ã«é»„è‰²ä½“ï¼ˆYellow bodyï¼‰ãŒã¿ã‚‰ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "ç¡å­åŒ–ç´¢çŠ¶è…«ç˜ã§ã¯å‘¨å›²ã«æ˜æšˆã‚’ä¼´ã†æ·¡æŸ“æ€§ã®æ»´çŠ¶ç‰©ã§ã‚ã‚‹é»„è‰²ä½“ï¼ˆYellow bodyï¼‰ãŒã¿ã‚‰ã‚Œã¾ã™ã€‚",
        topic: "ç”²çŠ¶è…º"
      }
    ],
    intermediate: [
      {
        id: 13,
        question: "MTAPè›‹ç™½ãŒç´°èƒè³ªã‹ã‚‰æ¶ˆå¤±ã™ã‚‹ã“ã¨ã¯ä¸­çš®è…«ã®é‘‘åˆ¥ã«æœ‰ç”¨ã§ã‚ã‚‹ã€‚",
        answer: true,
        explanation: "ä¸­çš®è…«ã§ã¯CDKN2A(p16)ã®ãƒ›ãƒ¢æ¬ å¤±ãŒã¿ã‚‰ã‚Œã€ãã®ä»£æ›¿ãƒãƒ¼ã‚«ãƒ¼ã¨ã—ã¦MTAPãŒä½¿ã‚ã‚Œã¾ã™ã€‚CDKN2A(p16)ã®ãƒ›ãƒ¢æ¬ å¤±ãŒã‚ã‚Œã°ã€MTAPå…æŸ“ã§ç´°èƒè³ªã®ç™ºç¾ãŒé«˜ç‡ã«æ¶ˆå¤±ã—ã¾ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 14,
        question: "å°ç’°ç´°èƒç™Œã®ç´°èƒè³ªå†…ç²˜æ¶²ã¯Berlin blueæŸ“è‰²é™½æ€§ã§ã‚ã‚‹ã€‚",
        answer: false,
        explanation: "ç´°èƒè³ªå†…ã®ç²˜æ¶²ã¯Berlin blueæŸ“è‰²ã§ã¯ãªãAlcian blueæŸ“è‰²ãŒé™½æ€§ã§ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 15,
        question: "å¤šå½¢å‹æ¨ªç´‹ç­‹è‚‰è…«ã¯å°å…ã«å¥½ç™ºã™ã‚‹ã€‚",
        answer: false,
        explanation: "å¤šå½¢å‹æ¨ªç´‹ç­‹è‚‰è…«ã¯50ä»£ãªã©ã®é«˜é½¢è€…ã«å¤šãç™ºç—‡ã—ã¾ã™ã€‚å°å…ã«å¥½ç™ºã™ã‚‹ã®ã¯èƒå…å‹ã‚„èƒå·£å‹ã§ã™ã€‚",
        topic: "è»Ÿéƒ¨è…«ç˜"
      },
      {
        id: 16,
        question: "èƒå·£çŠ¶è»Ÿéƒ¨è‚‰è…«ã§ã¯ç´°èƒè³ªã«PASåå¿œé™½æ€§ã®çµæ™¶æ§‹é€ ç‰©ã‚’èªã‚ã‚‹ã€‚",
        answer: true,
        explanation: "èƒå·£çŠ¶è»Ÿéƒ¨è‚‰è…«ã¯ç´°èƒè³ªã«ã‚¸ã‚¢ã‚¹ã‚¿ãƒ¼ã‚¼æŠµæŠ—æ€§ã®PASé™½æ€§é‡çŠ¶çµæ™¶ã‚’èªã‚ã¾ã™ã€‚ã“ã®çµæ™¶ã¯PAMã§ç¢ºèªã—ã‚„ã™ã„ã¨ã•ã‚Œã¾ã™ã€‚",
        topic: "è»Ÿéƒ¨è…«ç˜"
      },
      {
        id: 17,
        question: "è¡€ç®¡è‚‰è…«ã§ã¯ETSé–¢é€£éºä¼å­ï¼ˆERGï¼‰è›‹ç™½ãŒç´°èƒè†œã«é™½æ€§ã¨ãªã‚‹ã€‚",
        answer: false,
        explanation: "è¡€ç®¡è‚‰è…«ã§ã¯ERGã¯ã€Œæ ¸ã€ã«é™½æ€§ã¨ãªã‚Šã¾ã™ã€‚ç´°èƒè†œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ERGã¯è¡€ç®¡è‚‰è…«ã§æ„Ÿåº¦ãŒé«˜ã„ãƒãƒ¼ã‚«ãƒ¼ã§ã™ã€‚",
        topic: "è»Ÿéƒ¨è…«ç˜"
      },
      {
        id: 18,
        question: "Pagetç—…ã§ã¯å¾®å°æµ¸æ½¤ã¯ã¿ã‚‰ã‚Œãªã„ã€‚",
        answer: false,
        explanation: "Pagetç—…ã¯é–“è³ªæµ¸æ½¤ãŒã‚ã‚‹å ´åˆã¯å¾®å°æµ¸æ½¤ã¾ã§ã¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å¾®å°æµ¸æ½¤ãŒã¿ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
        topic: "ä¹³è…º"
      },
      {
        id: 19,
        question: "äºœæ€¥æ€§ç”²çŠ¶è…ºç‚ã§ã¯å¤šæ ¸çµ„ç¹”çƒãŒã¿ã‚‰ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "äºœæ€¥æ€§ç”²çŠ¶è…ºç‚ã§ã¯èƒŒæ™¯ã®ç‚ç—‡ç´°èƒï¼ˆå¥½ä¸­çƒã‚„ãƒªãƒ³ãƒ‘çƒãªã©ï¼‰ã¨å¤šæ ¸çµ„ç¹”çƒã‚„é¡ä¸Šçš®ç´°èƒã®å‡ºç¾ãŒç‰¹å¾´ã§ã™ã€‚",
        topic: "ç”²çŠ¶è…º"
      },
      {
        id: 20,
        question: "ç¡å­åŒ–ç´¢çŠ¶è…«ç˜ã§ã¯å…ç–«çµ„ç¹”åŒ–å­¦ã§Ki-67ï¼ˆMIB-1ï¼‰ãŒç´°èƒè†œã«é™½æ€§ã‚’ç¤ºã™ã€‚",
        answer: true,
        explanation: "ç¡å­åŒ–ç´¢çŠ¶è…«ç˜ã¯å…æŸ“ãŒç‰¹å¾´çš„ã§ã€å¤šãã®è…«ç˜ã§æ ¸ã«é™½æ€§ã‚’ç¤ºã™MIB-1ãŒã€Œç´°èƒè†œã€ã«é™½æ€§ã‚’ç¤ºã—ã¾ã™ã€‚",
        topic: "ç”²çŠ¶è…º"
      },
      {
        id: 21,
        question: "é«„æ§˜ç™Œã¯å…ç–«çµ„ç¹”åŒ–å­¦ã§CEAé™½æ€§ã§ã‚ã‚‹ã€‚",
        answer: true,
        explanation: "é«„æ§˜ç™Œã®è…«ç˜ç´°èƒã¯CEAã‚„ã‚«ãƒ«ã‚·ãƒˆãƒ‹ãƒ³ã«é™½æ€§ã‚’ç¤ºã—ã¾ã™ã€‚ãã®ä»–ã€ã‚·ãƒŠãƒ—ãƒˆãƒ•ã‚£ã‚¸ãƒ³ã€ã‚¯ãƒ­ãƒ¢ã‚°ãƒ©ãƒ‹ãƒ³Aãªã©ã®ç¥çµŒå†…åˆ†æ³Œãƒãƒ¼ã‚«ãƒ¼ã«ã‚‚é™½æ€§ã§ã™ã€‚",
        topic: "ç”²çŠ¶è…º"
      }
    ],
    advanced: [
      {
        id: 22,
        question: "Calretininã¯ç´°èƒè†œã«é™½æ€§ã‚’ç¤ºã™ãŸã‚ä¸­çš®è…«ã®é‘‘åˆ¥ã«æœ‰ç”¨ã§ã‚ã‚‹ã€‚",
        answer: false,
        explanation: "Calretininã¯ã€Œç´°èƒè³ªã¨æ ¸ã€ã«é™½æ€§ã‚’ç¤ºã—ã¾ã™ã€‚ç´°èƒè†œã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 23,
        question: "p16/CDKN2Aãƒ›ãƒ¢æ¥åˆæ€§æ¬ å¤±ã¯ä¸­çš®è…«ã®é‘‘åˆ¥ã«æœ‰ç”¨ã§ã‚ã‚‹ã€‚",
        answer: true,
        explanation: "ä¸­çš®è…«ã§ã¯p16/CDKN2Aã®ãƒ›ãƒ¢æ¬ å¤±ãŒã¿ã‚‰ã‚Œã¾ã™ã€‚ãã®ä»–ã€BAP1æ¶ˆå¤±ï¼ˆæ ¸ï¼‰ã‚„NF2ãƒ˜ãƒŸæ¬ å¤±ãŒã‚ã‚Šã¾ã™ã€‚",
        topic: "ä½“è…”æ¶²"
      },
      {
        id: 24,
        question: "ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ”ãƒ«ã¯Schwannç´°èƒè…«ã®ç‰¹å¾´çš„ãªèƒŒæ™¯ã§ã‚ã‚‹ã€‚",
        answer: false,
        explanation: "Schwannç´°èƒè…«ã§ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ”ãƒ«ã¯ç‰¹å¾´ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ”ãƒ«ãŒè¦‹ã‚‰ã‚Œã‚„ã™ã„ã®ã¯ä¸­æ¢æ€§ç¥çµŒç´°èƒè…«ã€é«˜åº¦çµç¯€æ€§é«„èŠ½è…«ã€å¤šå±¤ãƒ­ã‚¼ãƒƒãƒˆæ€§èƒå…æ€§è…«ç˜ãªã©ã§ã™ã€‚",
        topic: "è„³è„Šé«„"
      },
      {
        id: 25,
        question: "æ»‘è†œè‚‰è…«ã¯å˜ç›¸å‹ã¨äºŒç›¸å‹ã«åˆ†é¡ã•ã‚Œã‚‹ã€‚",
        answer: true,
        explanation: "æ»‘è†œè‚‰è…«ã¯å˜ç›¸å‹ï¼ˆå˜ç›¸ç·šç¶­å‹ï¼‰ã€äºŒç›¸å‹ãŒã‚ã‚Šã¾ã™ã€‚ä½åˆ†åŒ–ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ã‚ã‚Šã¾ã™ãŒã€åŸºæœ¬çš„ã«ã¯2ã¤ã®å‹ã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚",
        topic: "è»Ÿéƒ¨è…«ç˜"
      },
      {
        id: 26,
        question: "ç²˜æ¶²å‹è„‚è‚ªè‚‰è…«ã¯é«˜åˆ†åŒ–å‹è„‚è‚ªè‚‰è…«ã«ç”±æ¥ã™ã‚‹ã€‚",
        answer: false,
        explanation: "é«˜åˆ†åŒ–å‹è„‚è‚ªè‚‰è…«ã‚’å‰é§†ç—…å¤‰ã¨ã™ã‚‹ã®ã¯ã€Œè„±åˆ†åŒ–å‹ã€è„‚è‚ªè‚‰è…«ã§ã™ã€‚ç²˜æ¶²å‹è„‚è‚ªè‚‰è…«ã¯ç•°ãªã‚‹ç–¾æ‚£ã§ã™ã€‚",
        topic: "è»Ÿéƒ¨è…«ç˜"
      },
      {
        id: 27,
        question: "ã‚®ãƒ©ãƒ³ãƒ»ãƒãƒ¬ãƒ¼ç—‡å€™ç¾¤ã®æ¨å®šã¯è„³è„Šé«„æ¶²ç´°èƒè¨ºã®ç›®çš„ã§ã‚ã‚‹ã€‚",
        answer: false,
        explanation: "ã‚®ãƒ©ãƒ³ãƒ»ãƒãƒ¬ãƒ¼ç—‡å€™ç¾¤ã®è„³è„Šé«„æ¶²æ¤œæŸ»ã¨ã„ãˆã°è›‹ç™½ç´°èƒä¹–é›¢ï¼ˆç´°èƒæ•°ã¯æ­£å¸¸ã§è›‹ç™½é‡ãŒå¢—åŠ ã™ã‚‹ç¾è±¡ï¼‰ãŒä¸€èˆ¬çš„ã§ã€ç´°èƒè¨ºãŒæœ‰åŠ¹ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
        topic: "è„³è„Šé«„"
      },
      {
        id: 28,
        question: "åŸºè³ªç”£ç”Ÿç™Œã¯ç´¡éŒ˜å½¢ç´°èƒã®ä»‹åœ¨ãŒç‰¹å¾´ã§ã‚ã‚‹ã€‚",
        answer: false,
        explanation: "åŸºè³ªç”£ç”Ÿç™Œã¯ç´¡éŒ˜å½¢ç´°èƒã‚„ç ´éª¨ç´°èƒã®ä»‹åœ¨ã¯ãªãã€è»Ÿéª¨åŸºè³ªã‚„éª¨åŸºè³ªã®ç”£ç”ŸãŒç‰¹å¾´ã§ã™ã€‚",
        topic: "ä¹³è…º"
      },
      {
        id: 29,
        question: "ç¡å­åŒ–ç´¢çŠ¶è…«ç˜ã§ã¯æ ¸å†…ç´°èƒè³ªå°å…¥ä½“ã¯ã¿ã‚‰ã‚Œãªã„ã€‚",
        answer: false,
        explanation: "ç¡å­åŒ–ç´¢çŠ¶è…«ç˜ã¯ä¹³é ­ç™Œã§ã‚ˆãè¦‹ã‚‰ã‚Œã‚‹æ ¸å†…ç´°èƒè³ªå°å…¥ä½“ã‚„æ ¸æºãŒã‚ˆãè¦‹ã‚‰ã‚Œã¾ã™ã€‚ãŸã ã—ã€ã™ã‚Šã‚¬ãƒ©ã‚¹çŠ¶æ ¸ã‚„æ ¸é‡ç•³ã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã€‚",
        topic: "ç”²çŠ¶è…º"
      },
      {
        id: 30,
        question: "è‰¯æ€§ã®å°¿è·¯ä¸Šçš®ç´°èƒé›†å¡Šã®è¾ºç¸ã«ã¯è¢«è“‹ï¼ˆå‚˜ï¼‰ç´°èƒãŒèªã‚ã‚‰ã‚Œãªã„ã€‚",
        answer: false,
        explanation: "è‰¯æ€§ã®å°¿è·¯ä¸Šçš®ç´°èƒé›†å¡Šè¾ºç¸ã«ã¯è¢«è“‹ç´°èƒï¼ˆã‚¢ãƒ³ãƒ–ãƒ¬ãƒ©ç´°èƒï¼‰ãŒèªã‚ã‚‰ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚è¢«è“‹ç´°èƒãŒèªã‚ã‚‰ã‚Œã‚Œã°è‰¯æ€§ã‚’è€ƒãˆã¾ã™ã€‚",
        topic: "å°¿"
      }
    ]
  };

  const difficultyLabels = {
    basic: { name: "åŸºç¤", icon: BookOpen, color: "bg-green-500", description: "åŸºæœ¬çš„ãªç´°èƒæ‰€è¦‹" },
    intermediate: { name: "æ¨™æº–", icon: Target, color: "bg-yellow-500", description: "é‘‘åˆ¥è¨ºæ–­ãƒ»å…ç–«çµ„ç¹”åŒ–å­¦" },
    advanced: { name: "ä¸Šç´š", icon: Star, color: "bg-red-500", description: "è¤‡é›‘ãªç—…ç†æ‰€è¦‹ãƒ»åˆ†å­ç—…ç†" }
  };

  // å•é¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦é¸æŠ
  const shuffleQuestions = (questions, count = 20) => {
    const shuffled = [...questions].sort(() => Math.random() - 0.5);
    return shuffled.slice(0, Math.min(count, shuffled.length));
  };

  const startQuiz = (selectedDifficulty) => {
    setDifficulty(selectedDifficulty);
    const questions = questionDatabase[selectedDifficulty];
    setShuffledQuestions(shuffleQuestions(questions));
    setGameState('quiz');
    setCurrentQuestionIndex(0);
    setScore(0);
    setUserAnswer(null);
    setShowResult(false);
  };

  const handleAnswer = (answer) => {
    setUserAnswer(answer);
    setShowResult(true);
    
    const currentQuestion = shuffledQuestions[currentQuestionIndex];
    if (answer === currentQuestion.answer) {
      setScore(score + 1);
    }

    setTimeout(() => {
      if (currentQuestionIndex + 1 < shuffledQuestions.length) {
        setCurrentQuestionIndex(currentQuestionIndex + 1);
        setUserAnswer(null);
        setShowResult(false);
      } else {
        setGameState('end');
      }
    }, 2500);
  };

  const resetQuiz = () => {
    setGameState('start');
    setCurrentQuestionIndex(0);
    setScore(0);
    setUserAnswer(null);
    setShowResult(false);
    setShuffledQuestions([]);
  };

  const getScoreColor = (percentage) => {
    if (percentage >= 80) return 'text-green-600';
    if (percentage >= 60) return 'text-yellow-600';
    return 'text-red-600';
  };

  const getGrade = (percentage) => {
    if (percentage >= 90) return { grade: 'S', message: 'å®Œç’§ã§ã™ï¼ç´°èƒæ¤œæŸ»å£«ã¨ã—ã¦ååˆ†ãªçŸ¥è­˜ã§ã™ï¼' };
    if (percentage >= 80) return { grade: 'A', message: 'ç´ æ™´ã‚‰ã—ã„ï¼è©¦é¨“åˆæ ¼ãƒ¬ãƒ™ãƒ«ã§ã™ï¼' };
    if (percentage >= 70) return { grade: 'B', message: 'è‰¯å¥½ã§ã™ï¼ã‚‚ã†å°‘ã—å¾©ç¿’ã—ã¦å®Œç’§ã«ï¼' };
    if (percentage >= 60) return { grade: 'C', message: 'åŸºç¤ã¯ã§ãã¦ã„ã¾ã™ã€‚å¿œç”¨å•é¡Œã‚’ç·´ç¿’ã—ã¾ã—ã‚‡ã†ï¼' };
    return { grade: 'D', message: 'åŸºç¤ã‹ã‚‰å¾©ç¿’ãŒå¿…è¦ã§ã™ã€‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼' };
  };

  if (gameState === 'start') {
    return (
      <div className="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg">
        <div className="text-center mb-8">
          <div className="mb-4">
            <div className="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <BookOpen className="w-8 h-8 text-blue-600" />
            </div>
            <h1 className="text-3xl font-bold text-gray-800 mb-2">ç´°èƒæ¤œæŸ»å£«è©¦é¨“ â—‹Ã—å•é¡Œé›†</h1>
            <p className="text-gray-600">å®Ÿéš›ã®éå»å•ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæœ¬æ ¼çš„ãªè©¦é¨“å¯¾ç­–</p>
          </div>
        </div>

        <div className="grid gap-6 md:grid-cols-3">
          {Object.entries(difficultyLabels).map(([key, config]) => {
            const IconComponent = config.icon;
            const questionCount = questionDatabase[key].length;
            
            return (
              <div key={key} className="border rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer" onClick={() => startQuiz(key)}>
                <div className="text-center">
                  <div className={`w-12 h-12 ${config.color} rounded-full flex items-center justify-center mx-auto mb-4`}>
                    <IconComponent className="w-6 h-6 text-white" />
                  </div>
                  <h3 className="text-xl font-bold text-gray-800 mb-2">{config.name}ãƒ¬ãƒ™ãƒ«</h3>
                  <p className="text-gray-600 text-sm mb-4">{config.description}</p>
                  <div className="bg-gray-100 rounded-lg p-3 mb-4">
                    <div className="text-2xl font-bold text-gray-800">{questionCount}å•</div>
                    <div className="text-xs text-gray-600">ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œ</div>
                  </div>
                  <button className={`w-full ${config.color} text-white py-2 px-4 rounded-lg font-semibold hover:opacity-90 transition-opacity`}>
                    é–‹å§‹ã™ã‚‹
                  </button>
                </div>
              </div>
            );
          })}
        </div>

        <div className="mt-8 bg-blue-50 rounded-lg p-6">
          <h3 className="text-lg font-bold text-blue-800 mb-3">ğŸ’¡ å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
          <div className="grid md:grid-cols-2 gap-4 text-sm text-blue-700">
            <div>
              <strong>åŸºç¤ãƒ¬ãƒ™ãƒ«:</strong> å„è‡“å™¨ã®åŸºæœ¬çš„ãªç´°èƒæ‰€è¦‹
            </div>
            <div>
              <strong>æ¨™æº–ãƒ¬ãƒ™ãƒ«:</strong> é‘‘åˆ¥è¨ºæ–­ãƒ»å…ç–«çµ„ç¹”åŒ–å­¦
            </div>
            <div>
              <strong>ä¸Šç´šãƒ¬ãƒ™ãƒ«:</strong> è¤‡é›‘ãªç—…ç†æ‰€è¦‹ãƒ»åˆ†å­ç—…ç†
            </div>
            <div>
              <strong>å‡ºé¡Œç¯„å›²:</strong> ä½“è…”æ¶²ãƒ»è„³è„Šé«„ãƒ»ä¹³è…ºãƒ»ç”²çŠ¶è…ºãƒ»è»Ÿéƒ¨ãƒ»å°¿
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (gameState === 'quiz') {
    const currentQuestion = shuffledQuestions[currentQuestionIndex];
    const progress = ((currentQuestionIndex + 1) / shuffledQuestions.length) * 100;
    
    return (
      <div className="max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-lg">
        <div className="mb-6">
          <div className="flex justify-between items-center mb-4">
            <div className="flex items-center gap-4">
              <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                {difficultyLabels[difficulty].name}ãƒ¬ãƒ™ãƒ«
              </span>
              <span className="text-gray-600 font-semibold">
                å•é¡Œ {currentQuestionIndex + 1} / {shuffledQuestions.length}
              </span>
            </div>
            <div className="text-right">
              <div className="text-lg font-bold text-blue-600">ã‚¹ã‚³ã‚¢: {score}</div>
              <div className="text-sm text-gray-600">æ­£ç­”ç‡: {currentQuestionIndex > 0 ? Math.round((score / currentQuestionIndex) * 100) : 0}%</div>
            </div>
          </div>
          
          <div className="w-full bg-gray-200 rounded-full h-2">
            <div 
              className="bg-blue-600 h-2 rounded-full transition-all duration-300"
              style={{ width: `${progress}%` }}
            ></div>
          </div>
        </div>

        <div className="bg-gray-50 rounded-lg p-6 mb-6">
          <div className="flex items-center gap-2 mb-3">
            <span className="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs font-semibold">
              {currentQuestion.topic}
            </span>
          </div>
          <h2 className="text-xl font-bold text-gray-800 mb-6 leading-relaxed">
            {currentQuestion.question}
          </h2>

          {!showResult ? (
            <div className="flex gap-4 justify-center">
              <button
                onClick={() => handleAnswer(true)}
                className="flex-1 max-w-xs bg-green-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center gap-3"
              >
                <CheckCircle className="w-6 h-6" />
                â—‹ï¼ˆæ­£ã—ã„ï¼‰
              </button>
              <button
                onClick={() => handleAnswer(false)}
                className="flex-1 max-w-xs bg-red-600 text-white py-4 px-6 rounded-lg text-lg font-semibold hover:bg-red-700 transition-colors flex items-center justify-center gap-3"
              >
                <XCircle className="w-6 h-6" />
                Ã—ï¼ˆé–“é•ã„ï¼‰
              </button>
            </div>
          ) : (
            <div className="text-center">
              <div className={`p-4 rounded-lg mb-4 ${
                userAnswer === currentQuestion.answer 
                  ? 'bg-green-100 border-green-500' 
                  : 'bg-red-100 border-red-500'
              } border-2`}>
                <div className="flex items-center justify-center gap-3 mb-3">
                  {userAnswer === currentQuestion.answer ? (
                    <>
                      <CheckCircle className="w-8 h-8 text-green-600" />
                      <span className="text-2xl font-bold text-green-700">æ­£è§£ï¼</span>
                    </>
                  ) : (
                    <>
                      <XCircle className="w-8 h-8 text-red-600" />
                      <span className="text-2xl font-bold text-red-700">ä¸æ­£è§£</span>
                    </>
                  )}
                </div>
                <div className="text-lg font-semibold text-gray-700 mb-1">
                  æ­£ç­”: {currentQuestion.answer ? 'â—‹ï¼ˆæ­£ã—ã„ï¼‰' : 'Ã—ï¼ˆé–“é•ã„ï¼‰'}
                </div>
              </div>
              
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 text-left">
                <h4 className="font-bold text-blue-800 mb-2">ğŸ“š è§£èª¬</h4>
                <p className="text-blue-700 leading-relaxed">{currentQuestion.explanation}</p>
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  if (gameState === 'end') {
    const percentage = Math.round((score / shuffledQuestions.length) * 100);
    const gradeInfo = getGrade(percentage);
    
    return (
      <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg">
        <div className="text-center mb-8">
          <Trophy className="w-16 h-16 mx-auto mb-4 text-yellow-500" />
          <h2 className="text-3xl font-bold text-gray-800 mb-2">è©¦é¨“çµæœ</h2>
          <p className="text-gray-600">{difficultyLabels[difficulty].name}ãƒ¬ãƒ™ãƒ«å®Œäº†</p>
        </div>

        <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-6">
          <div className="text-center mb-6">
            <div className={`text-6xl font-bold mb-2 ${getScoreColor(percentage)}`}>
              {gradeInfo.grade}
            </div>
            <div className="text-3xl font-bold text-gray-800 mb-2">
              {score} / {shuffledQuestions.length}
            </div>
            <div className={`text-xl font-semibold ${getScoreColor(percentage)}`}>
              æ­£ç­”ç‡ {percentage}%
            </div>
          </div>
          
          <div className="bg-white rounded-lg p-4 shadow-inner">
            <p className="text-gray-700 text-center font-medium">{gradeInfo.message}</p>
          </div>
        </div>

        <div className="bg-gray-50 rounded-lg p-4 mb-6">
          <h3 className="font-bold text-gray-800 mb-3">ğŸ“Š è©³ç´°çµæœ</h3>
          <div className="grid grid-cols-2 gap-4 text-center">
            <div className="bg-white rounded-lg p-3">
              <div className="text-2xl font-bold text-green-600">{score}</div>
              <div className="text-sm text-gray-600">æ­£è§£æ•°</div>
            </div>
            <div className="bg-white rounded-lg p-3">
              <div className="text-2xl font-bold text-red-600">{shuffledQuestions.length - score}</div>
              <div className="text-sm text-gray-600">ä¸æ­£è§£æ•°</div>
            </div>
          </div>
        </div>

        <div className="text-center space-y-4">
          <button
            onClick={() => startQuiz(difficulty)}
            className="bg-blue-600 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2 mx-auto"
          >
            <RotateCcw className="w-5 h-5" />
            åŒã˜ãƒ¬ãƒ™ãƒ«ã§ã‚‚ã†ä¸€åº¦
          </button>
          <button
            onClick={resetQuiz}
            className="text-gray-600 hover:text-gray-800 flex items-center gap-2 mx-auto"
          >
            ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹
          </button>
        </div>
      </div>
    );
  }
};

export default CytologyQuizSystem;
